---
title: "R Notebook For Applied Data Science-Project I"
output:
  html_document: default
  html_notebook: default
runtime: shiny
---
```{r, message=FALSE, warning=FALSE, include=FALSE}
#NECESSARY PACKAGES

#Please make sure all package referred in this file are properly loaded
###################################################################
source("D:/Columbia University/Spring2017-Applied Data Science/Project_1_Bz2290/Spr2017-Proj1-bz2290/doc/Package.R")
###################################################################

#Functions needed
###################################################################
source("D:/Columbia University/Spring2017-Applied Data Science/Project_1_Bz2290/Spr2017-Proj1-bz2290/lib/Functions.R")
###################################################################
```

```{r, include=FALSE}
##PREPRCESSIONING OF THE DATA##

#Please also modify the path within Preprocess.R
###################################################################
source("D:/Columbia University/Spring2017-Applied Data Science/Project_1_Bz2290/Spr2017-Proj1-bz2290/output/Preprocess.R")
###################################################################
```
I. INTRODUCTION

There are two groups of presidential speeches, while the first group is choosen while U.S.is either involved or there is a major tense moment happening in the internaitonal society. While the second group of speeches are choosen during the time when the U.S. economy is booming. We hope to utilize the sentiment ananlysis and other related techniques to see if there are any differneces betweeen those two groups, or if there are any similiarites withiin each group.  

This notebook was prepared with the following environmental settings:
```{r, echo=FALSE}
print(R.version)
```

II.SENTENCE LENGTH

After the data preprocessing(Please refer to "Preprocess.R" for details), we first examine the sentence length of speeches with respect to two groups. What we find first is that from all the speeches I selected, almost all president give a shorter speeches in their second term compared to theris first ones. For example, we observed that from Lincoln's speeches:
```{r, echo=FALSE}
sentence=emotion.matrix[,1:4]
sentence=subset(sentence,as.character(sentence$President) %in% c(speech.selected.war[1],speech.selected.war[2]))
sentence$Pop = factor(sentence$President)
sentence$Ordered=reorder(sentence$Pop,sentence$nword,mean,order=T)
beeswarm(nword~Ordered, 
         data=sentence,
         horizontal = FALSE, 
         pch=1, col="blue",
         cex=0.5, cex.axis=1.1, cex.lab=1.2,
         spacing=5/nlevels(sentence$Ordered),
         las=2,ylab="Number of words",
         xlab="",
         main="Inauguartion speeches")
```
or for Franklin D. Roosevelt:
```{r, echo=FALSE}
par(mfrow=c(1,2))
sentence=emotion.matrix[,1:4]
sentence=subset(sentence,as.character(sentence$President) %in% c(speech.selected.war[5],speech.selected.war[6]))
sentence$Pop = factor(sentence$President)
sentence$Ordered=reorder(sentence$Pop,sentence$nword,mean,order=T)
beeswarm(nword~Ordered, 
         data=sentence,
         horizontal = FALSE, 
         pch=10, col="blue",
         cex=0.3, cex.axis=1.1, cex.lab=1.2,
         spacing=5/nlevels(sentence$Ordered),
         las=2,ylab="Number of words",
         xlab="",
         main="Inauguartion speeches")

sentence=emotion.matrix[,1:4]
sentence=subset(sentence,as.character(sentence$President) %in% c(speech.selected.war[6],speech.selected.war[7]))
sentence$Pop = factor(sentence$President)
sentence$Ordered=reorder(sentence$Pop,sentence$nword,mean,order=T)
beeswarm(nword~Ordered, 
         data=sentence,
         horizontal = FALSE, 
         pch=10, col="blue",
         cex=0.3, cex.axis=1.1, cex.lab=1.2,
         spacing=5/nlevels(sentence$Ordered),
         las=2,ylab="Number of words",
         xlab="",
         main="Inauguartion speeches")
```
We see that from the second to the fourth speeches, the sentences length has decreased from one speech to another.

Despite this pattern, I have also discovered that:
```{r, echo=FALSE}
par(mfrow=c(1,1))
sentence=emotion.matrix[,1:4]
sentence=subset(sentence,as.character(sentence$President) %in% c(speech.selected.war,speech.selected.peace))
sentence$Pop = factor(sentence$President)
sentence$Ordered=reorder(sentence$Pop,sentence$nword,mean,order=T)
beeswarm(nword~Ordered, 
         data=sentence,
         horizontal = FALSE, 
         pch=1, col="blue",
         cex=0.5, cex.axis=1.1, cex.lab=1.2,
         spacing=5/nlevels(sentence$Ordered),
         las=2,ylab="Number of words",
         xlab="",
         main="Inauguartion speeches")
```
All speeches I have choosen have majority of their sentences within 20 words, and there are only a few president who gives extremely long sentences.

II.Sentiment Analysis

After we have examined the length of sentence, we turn our attention to a more interesting asepct of ananlysis - sentiment analysis. I performed the analysis by applied nrc sentimet function to sentences, and calculate a weighted score of emotion "anger", "anticipation", "disgust", "fear", "joy", "sadness", "surprise", "trust", "negative", "positive" at each sentence of each presidential speeches I selected
```{r}
#Generally, we see that all speeches have its majority amount of sentences only have smaller than or equal to 20 words.BUt if we start to examine individual speeches, first we find out that most presidents' first and second speech(if there are any), have the similiar distribution of sentence length. Only a small amount of presdeints have their second speech significantly smaller than the first one.
```

```{r}
#If we start to compare speeches given in tense moments and speeches given in rather peaceful or even prosper moments:

#We can see that in general, speeches give nin prosper time has a greater hortizonatal spread(namly has more sentences that are close to 20 words) than those are given during war or tense moments.
```


```{r}
#Next we take a look at the heatmap and Barplot of emotion:
#IN order to ease our comparsion, we use number 1 to 10 to denote the ten speeches we selected.
```

```{r, echo=FALSE}
#Heatmap & Barplot
shinyApp(
  ui=fluidPage(
    sidebarLayout(
        sidebarPanel(
   sliderInput("Pop","President",min=1,max=length(speech.selected),value=1,step=1)),
    mainPanel(
      tabsetPanel(
      tabPanel("Heatmap",uiOutput("ui_heatmap")),
      tabPanel("Barplot",plotOutput("Barplot"))
      ))
     )
    ),
  server = function(input,output){
    output$ui_heatmap <- renderUI({
    d3heatmapOutput("heatmap")
  })

  output$heatmap <- renderD3heatmap({ 
    d3heatmap(cor(emotion.matrix%>%filter(President==speech.selected[input$Pop])%>%select(anger:trust)),Rowv = FALSE, dendrogram = "row",Colv=FALSE,color="Blues") 
  })
      output$Barplot = renderPlot(
      {
        Emotion_Barplot(speech.selected[input$Pop])
      }
    )
    
    
  }
)
```

```{r}
#There is no surprise that the top 3 emotions that appear the most in the speeches given during peaceful time are majorityly postive emtions. But, surprisingly,When examine the barplot of our selected speeches given during the war time, we see that, except the second speech given by AbrhamLincoln, during which the civil war was about to end, all the other speeches tend to have the trust emotion the most, and relative positive amotion such as joy and anticipation also came second the most. There are only three time when begative emotion such as fear came to the first and the second, while two tims come from Lincoln's two speeches, and the last one came from FrankdRooselt's second speech. In addition, after the second speech, the postive words went back to be the top 2 emotions from Rooselevt's speech. This rather surprising pattern is interesting, as our general assumption was those speeches should not be very positive during war times. What is more, we can also observe that emtions like Joy,trust,anticipation and fear will come in top 4 every time.This patterns deserve a little bit of digging and we will examine that further in the next part.

#In addition to those, the heatmap reveals that the negative emotion sich as anger was usually related to fear and digust, where posiive emotion such as anticipitian is usually realted to joy.
```


```{r}
#Now we want to take a look at the sentence with positive emotions and try to find out more interesting part.
```

```{r}
#Joy-War time Speeches#
```

```{r, echo=FALSE, message=FALSE}
print(speech.selected[1])
Emotion_Sentences(pop=speech.selected[1])[5,]

print(speech.selected[2])
Emotion_Sentences(pop=speech.selected[2])[5,]

print(speech.selected[3])
Emotion_Sentences(pop=speech.selected[3])[5,]

print(speech.selected[4])
Emotion_Sentences(pop=speech.selected[4])[5,]

print(speech.selected[5])
Emotion_Sentences(pop=speech.selected[5])[5,]

print(speech.selected[6])
Emotion_Sentences(pop=speech.selected[6])[5,]

print(speech.selected[7])
Emotion_Sentences(pop=speech.selected[7])[5,]

print(speech.selected[8])
Emotion_Sentences(pop=speech.selected[8])[5,]

print(speech.selected[9])
Emotion_Sentences(pop=speech.selected[9])[5,]

print(speech.selected[10])
Emotion_Sentences(pop=speech.selected[10])[5,]
```

```{r}
#Joy-Peaecful time Speeches#
```

```{r, echo=FALSE, message=FALSE}
print(speech.selected[11])
Emotion_Sentences(pop=speech.selected[11])[5,]

print(speech.selected[12])
Emotion_Sentences(pop=speech.selected[12])[5,]

print(speech.selected[13])
Emotion_Sentences(pop=speech.selected[13])[5,]

print(speech.selected[14])
Emotion_Sentences(pop=speech.selected[14])[5,]
```

```{r}
#Trust-War time Speeches#
```

```{r, echo=FALSE, message=FALSE}
print(speech.selected[1])
Emotion_Sentences(pop=speech.selected[1])[8,]

print(speech.selected[2])
Emotion_Sentences(pop=speech.selected[2])[8,]

print(speech.selected[3])
Emotion_Sentences(pop=speech.selected[3])[8,]

print(speech.selected[4])
Emotion_Sentences(pop=speech.selected[4])[8,]

print(speech.selected[5])
Emotion_Sentences(pop=speech.selected[5])[8,]

print(speech.selected[6])
Emotion_Sentences(pop=speech.selected[6])[8,]

print(speech.selected[7])
Emotion_Sentences(pop=speech.selected[7])[8,]

print(speech.selected[8])
Emotion_Sentences(pop=speech.selected[8])[8,]

print(speech.selected[9])
Emotion_Sentences(pop=speech.selected[9])[8,]

print(speech.selected[10])
Emotion_Sentences(pop=speech.selected[10])[8,]
```

```{r}
#Trust-Peaecful time Speeches#
```

```{r, echo=FALSE, message=FALSE}
print(speech.selected[11])
Emotion_Sentences(pop=speech.selected[11])[8,]

print(speech.selected[12])
Emotion_Sentences(pop=speech.selected[12])[8,]

print(speech.selected[13])
Emotion_Sentences(pop=speech.selected[13])[8,]

print(speech.selected[14])
Emotion_Sentences(pop=speech.selected[14])[8,]
```

```{r}
#Anticipation-War time Speeches#
```

```{r, echo=FALSE, message=FALSE}
print(speech.selected[1])
Emotion_Sentences(pop=speech.selected[1])[2,]

print(speech.selected[2])
Emotion_Sentences(pop=speech.selected[2])[2,]

print(speech.selected[3])
Emotion_Sentences(pop=speech.selected[3])[2,]

print(speech.selected[4])
Emotion_Sentences(pop=speech.selected[4])[2,]

print(speech.selected[5])
Emotion_Sentences(pop=speech.selected[5])[2,]

print(speech.selected[6])
Emotion_Sentences(pop=speech.selected[6])[2,]

print(speech.selected[7])
Emotion_Sentences(pop=speech.selected[7])[2,]

print(speech.selected[8])
Emotion_Sentences(pop=speech.selected[8])[2,]

print(speech.selected[9])
Emotion_Sentences(pop=speech.selected[9])[2,]

print(speech.selected[10])
Emotion_Sentences(pop=speech.selected[10])[2,]
```

```{r}
#Anticipation-Peaecful time Speeches#
```

```{r, echo=FALSE, message=FALSE}
print(speech.selected[11])
Emotion_Sentences(pop=speech.selected[11])[2,]

print(speech.selected[12])
Emotion_Sentences(pop=speech.selected[12])[2,]

print(speech.selected[13])
Emotion_Sentences(pop=speech.selected[13])[2,]

print(speech.selected[14])
Emotion_Sentences(pop=speech.selected[14])[2,]
```

```{r}
#Fear-War time Speeches#
```

```{r, echo=FALSE, message=FALSE}
print(speech.selected[1])
Emotion_Sentences(pop=speech.selected[1])[4,]

print(speech.selected[2])
Emotion_Sentences(pop=speech.selected[2])[4,]

print(speech.selected[3])
Emotion_Sentences(pop=speech.selected[3])[4,]

print(speech.selected[4])
Emotion_Sentences(pop=speech.selected[4])[4,]

print(speech.selected[5])
Emotion_Sentences(pop=speech.selected[5])[4,]

print(speech.selected[6])
Emotion_Sentences(pop=speech.selected[6])[4,]

print(speech.selected[7])
Emotion_Sentences(pop=speech.selected[7])[4,]

print(speech.selected[8])
Emotion_Sentences(pop=speech.selected[8])[4,]

print(speech.selected[9])
Emotion_Sentences(pop=speech.selected[9])[4,]

print(speech.selected[10])
Emotion_Sentences(pop=speech.selected[10])[4,]
```

```{r}
#Fear-Peaecful time Speeches#
```

```{r, eval=FALSE, message=FALSE, include=FALSE}
print(speech.selected[11])
Emotion_Sentences(pop=speech.selected[11])[4,]
#table(as.string(Emotion_Sentences(pop=speech.selected[11])[4,2]))

print(speech.selected[12])
Emotion_Sentences(pop=speech.selected[12])[4,]

print(speech.selected[13])
Emotion_Sentences(pop=speech.selected[13])[4,]

print(speech.selected[14])
Emotion_Sentences(pop=speech.selected[14])[4,]
```

```{r}
presid.summary=tbl_df(emotion.matrix)%>%
  filter(President%in%speech.selected)%>%
  #group_by(paste0(type, File))%>%
  group_by(President)%>%
  summarise(
    anger=mean(anger,na.rm=TRUE),
    anticipation=mean(anticipation,na.rm=TRUE),
    disgust=mean(disgust,na.rm=TRUE),
    fear=mean(fear,na.rm=TRUE),
    joy=mean(joy,na.rm=TRUE),
    sadness=mean(sadness,na.rm=TRUE),
    surprise=mean(surprise,na.rm=TRUE),
    trust=mean(trust,na.rm=TRUE)
    #negative=mean(negative),
    #positive=mean(positive)
  )

presid.summary=as.data.frame(presid.summary)
rownames(presid.summary)=as.character((presid.summary[,1]))
km.res=kmeans(presid.summary[,-1],4,iter.max=200,nstart=5)
fviz_cluster(km.res, 
             stand=F, repel= TRUE,
             data = presid.summary[,-1], xlab="", xaxt="n",
             show.clust.cent=FALSE)
```

