---
title: "R Notebook For Applied Data Science-Project I"
output:
  html_document: default
  html_notebook: default
---
```{r}
#Before we start to analysis the inaugration speech given by each president, we have to read in and preprecess our data to ease our analysis that will be carried out later.
```

```{r}
library(tm)
library(wordcloud)
library(RColorBrewer)
library(dplyr)
library(tidytext)
library(RCurl)
library(dplyr)
library(ggplot2)
##PREPRCESSIONING OF THE DATA##

folder.path="D:/Columbia University/Spring2017-Applied Data Science/Project_1_Bz2290/Spr2017-Proj1-bz2290/data/InauguralSpeeches"
speeches=list.files(path = folder.path, pattern = "*.txt")
prez.out=substr(speeches, 6, nchar(speeches)-4)
length.speeches=rep(NA, length(speeches))
ff.all<-Corpus(DirSource(folder.path))
#REMOVE WHITE SPACE FROM CORPUS
ff.all<-tm_map(ff.all, stripWhitespace)
#TRANSFORM LETTERS TO LOWER CASE TO WAS OUR ANALYSIS
ff.all<-tm_map(ff.all, content_transformer(tolower))
#REMOVE COMMON STOPWORDS IN ENGLISH
ff.all<-tm_map(ff.all, removeWords, stopwords("english"))
#REMOVE EMPTY CHARATERS
ff.all<-tm_map(ff.all, removeWords, character(0))
#REMOVE PUNCTIONS
ff.all<-tm_map(ff.all, removePunctuation)
#REMOVE NUMBERS
ff.all = tm_map(ff.all,removeNumbers)

#TURN INTO A DOCUMENT MATRIX
dtm<-DocumentTermMatrix(ff.all)
#REMOVE SPASRE WORD
#dtms = removeSparseTerms(dtm,0.1)
#WRITE is into a CSV
write.csv(as.matrix(dtm),file="dtm.csv")
dates = read.table("InauguationDatesEdit.txt",header = TRUE)
#Add Year Column to classify years this speech is given
#tdm.tidy=tidy(tdm.all)
#tdm.overall=summarise(group_by(tdm.tidy, term), sum(count))
```

```{r}
###Sentiment analysis###

table = read.csv("dtmedits.csv",header=TRUE)
table$Presdient = gsub("inaug|.txt","",table$X)
#dates$FIRST = gsub("[0-9]+[/][0-9]+[/]","",dates$FIRST)
#dates$SECOND = gsub("[0-9]+[/][0-9]+[/]","",dates$SECOND)
#dates$THIRD = gsub("[0-9]+[/][0-9]+[/]","",dates$THIRD)
#dates$FOURTH = gsub("[0-9]+[/][0-9]+[/]","",dates$FOURTH)
#dates=dates[order(dates$PRESIDENT),]
positives= readLines("positive-words.txt")
negatives = readLines("negative-words.txt")
#Sentiment Score Function#

    score.sentiment =  function(lines, pos.words, neg.words) {
        # split into words. str_split is in the stringr package
        words = unlist(strsplit(lines, '\\s+'))
        # compare our words to the dictionaries of positive & negative terms
        pos.matches = match(words, pos.words)
        neg.matches = match(words, neg.words)
        # match() returns the position of the matched term or NA
        # we just want a TRUE/FALSE:
        pos.matches = !is.na(pos.matches)
        neg.matches = !is.na(neg.matches)
        # and conveniently enough, TRUE/FALSE will be treated as 1/0 by sum():
        score = sum(pos.matches) - sum(neg.matches)
        return(score)
      }
    senti_scores = c()
for(i in 1 : dim(table)[1])
{
  lines = unlist(strsplit(ff.all[[i]]$content,"\\s+"))
  senti_scores[i] = score.sentiment(lines,positives,negatives)
}
table$sentiscores=senti_scores
table = table[order(table$Year),]

#Plot the sentiment scores against President
plot.data.senti = as.data.frame(table[,9353:9354])
plot.data.senti$Year = table$Year
ggplot(plot.data.senti,aes(x=plot.data.senti$Year,y=plot.data.senti$sentiscores))+
  geom_point()+
  geom_line()+
  labs(title="Snetiment Scores for Presidential Inaugration Speech",y="Sentiment Scores",x = "Years")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  annotate("text",x=1861,y=20,label="Civil War",size=4,color=2)+
  annotate("point",x=1861,y=10,size=2,color=2)+
  annotate("point",x=1865,y=1,size=2,color=2)+
  annotate("text",x=1913,y=48,label="WWI",size=4,color=3)+
  annotate("point",x=1913,y=38,size=2,color=3)+
  annotate("text",x=1933,y=10,label="Big Depression & WWII",size=4,color=4)+
  annotate("point",x=1933,y=24,size=2,color=4)+
  annotate("point",x=1937,y=18,size=2,color=4)+
  annotate("point",x=1941,y=20,size=2,color=4)+
  annotate("point",x=1945,y=27,size=2,color=4)+
  annotate("text",x=1947,y=119,label="Cold War",size=4,color=5)+
  annotate("point",x=1945,y=109,size=2,color=5)+
  annotate("point",x=1953,y=98,size=2,color=5)+
  annotate("point",x=1957,y=44,size=2,color=5)+
  annotate("point",x=1961,y=15,size=2,color=5)+
  annotate("point",x=1963,y=34,size=2,color=5)+
  annotate("point",x=1969,y=66,size=2,color=5)+
  annotate("point",x=1973,y=82,size=2,color=5)+
  annotate("point",x=1977,y=60,size=2,color=5)+
  annotate("point",x=1981,y=44,size=2,color=5)+
  annotate("point",x=1985,y=85,size=2,color=5)+
  annotate("point",x=1989,y=121,size=2,color=5)+
  annotate("text",x=2001,y=84,label="911",size=4,color=6)+
  annotate("point",x=2001,y=64,size=2,color=6)+
  annotate("point",x=2005,y=73,size=2,color=6)+
  annotate("text",x=2009,y=34,label="FirstPresident",size=4,color=7)+
  annotate("point",x=2009,y=44,size=2,color=7)+
  annotate("point",x=2013,y=54,size=2,color=7)+
  annotate("text",x=2017,y=67,label="MAGA",size=4,color=11)+
  annotate("point",x=2017,y=57,size=2,color=11)
 
  
  
```


